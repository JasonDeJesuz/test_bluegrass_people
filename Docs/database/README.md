# Database Setup for People Directory

## Setup

##### There are 3 different ways which the database can be done, all 3 of which have been catered for in this project. ðŸ˜‰

1. Microsoft SQL Server (Stand-Alone installation and setup)
2. Docker MS SQL Server 2019
3. In Memory (Using EntityFrameworkCore.InMemory)

## 1. Microsoft SQL Server

## 2. Docker MS SQL Server 2019

You might find that having docker handle the database might be easier for you, in this case you can have the database running on your mac/windows using MS SQL Server Docker image.

### Install the Tools
First, you'll have to install the [Docker Desktop Application](https://www.docker.com/products/docker-desktop/)

Next, we pull the MS SQL 2019 Docker Image

```
docker pull mcr.microsoft.com/mssql/server:2019-latest
```

Once the download is complete, you need to launch your downloaded SQL Server image in Docker. To do that, use this command in Terminal:

```
docker run --name [type in your desired SQL Server name here] -e 'ACCEPT_EULA=Y' -e 'SA_PASSWORD=[type in your password for your database]' -e 'MSSQL_PID=[type in your Docker membership type]â€™ -p 1433:1433 -d mcr.microsoft.com/mssql/server:2019-latest
```

Here's an example

```
docker run --name SQLServer -e 'ACCEPT_EULA=Y' -e 'SA_PASSWORD=12345OHdf%e' -e 'MSSQL_PID=Expressâ€™ -p 1433:1433 -d mcr.microsoft.com/mssql/server:2019-latest
```

You can then connect to the database using the following connectionString

```
Server=localhost;Database=Bluegrass;User Id=sa; Password=12345OHdf%e; TrustServerCertificate=True;
```

## 3. In Memory

## Tech

### ðŸ‘‰ _Migrations
During development, you may have used the Create and Drop APIs to iterate quickly, changing your model as needed; but now that your application is going to production, you need a way to safely evolve the schema without dropping the entire database.

#### Install the Tools
First, you'll have to install the [EF Core command-line tools](https://docs.microsoft.com/en-us/ef/core/cli/):

We generally recommend using the [.NET Core CLI tools](https://docs.microsoft.com/en-us/ef/core/cli/dotnet), which work on all platforms.
If you're more comfortable working inside Visual Studio or have experience with EF6 migrations, you can also use the [Package Manager Console tools](https://docs.microsoft.com/en-us/ef/core/cli/powershell).

#### Create your first migration
```
dotnet ef migrations add InitialDatabase
```
EF Core will create a directory called Migrations in your project, and generate some files. It's a good idea to inspect what exactly EF Core generated - and possibly amend it - but we'll skip over that for now.

#### Create database and schema
```
dotnet ef database update
```

#### Updating the database with features
##### 1. Creating the migration
```
dotnet ef migrations add MakeMyChange
```
Note that we give migrations a descriptive name, to make it easier to understand the project history later.

Since this isn't the project's first migration, EF Core now compares your updated model against a snapshot of the old model, before the column was added; the model snapshot is one of the files generated by EF Core when you add a migration, and is checked into source control. Based on that comparison, EF Core detects that a column has been added, and adds the appropriate migration.

You can now apply your migration as before:

##### 2. Apply the migration
```
dotnet ef database update
```
Note that this time, EF detects that the database already exists. In addition, when our first migration was applied above, this fact was recorded in a special migrations history table in your database; this allows EF to automatically apply only the new migration.

## References
- [dotnet ef - migrations](https://docs.microsoft.com/en-us/ef/core/managing-schemas/migrations/?tabs=dotnet-core-cli)
- [MS SQL Server using Docker and Mac](https://setapp.com/how-to/install-sql-server)